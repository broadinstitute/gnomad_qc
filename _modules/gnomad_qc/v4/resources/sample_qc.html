<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>gnomad_qc.v4.resources.sample_qc &mdash; gnomad_qc master documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/theme_overrides.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/sphinx_highlight.js"></script>
        <script src="https://unpkg.com/mermaid@10.2.0/dist/mermaid.min.js"></script>
        <script>mermaid.initialize({startOnLoad:true});</script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            gnomad_qc
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../api_reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/broadinstitute/gnomad_qc/tags">Change Log</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">gnomad_qc</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">gnomad_qc.v4.resources.sample_qc</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for gnomad_qc.v4.resources.sample_qc</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Script containing sample QC related resources.&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>

<span class="kn">from</span> <span class="nn">gnomad.resources.resource_utils</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">MatrixTableResource</span><span class="p">,</span>
    <span class="n">PedigreeResource</span><span class="p">,</span>
    <span class="n">TableResource</span><span class="p">,</span>
    <span class="n">VersionedMatrixTableResource</span><span class="p">,</span>
    <span class="n">VersionedPedigreeResource</span><span class="p">,</span>
    <span class="n">VersionedTableResource</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">gnomad_qc.v4.resources.basics</span> <span class="kn">import</span> <span class="n">get_checkpoint_path</span><span class="p">,</span> <span class="n">qc_temp_prefix</span>
<span class="kn">from</span> <span class="nn">gnomad_qc.v4.resources.constants</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
    <span class="n">SAMPLE_QC_VERSIONS</span><span class="p">,</span>
<span class="p">)</span>


<div class="viewcode-block" id="get_sample_qc_root"><a class="viewcode-back" href="../../../../api_reference/v4/resources/sample_qc.html#gnomad_qc.v4.resources.sample_qc.get_sample_qc_root">[docs]</a><span class="k">def</span> <span class="nf">get_sample_qc_root</span><span class="p">(</span>
    <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span> <span class="n">test</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;exomes&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return path to sample QC root folder.</span>

<span class="sd">    :param version: Version of sample QC path to return.</span>
<span class="sd">    :param test: Whether to use a tmp path for analysis of the test VDS instead of the</span>
<span class="sd">        full v4 VDS.</span>
<span class="sd">    :param data_type: Data type used in sample QC, e.g. &quot;exomes&quot; or &quot;joint&quot;.</span>
<span class="sd">    :return: Root to sample QC path.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;gs://gnomad-tmp/gnomad_v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">_testing/sample_qc/</span><span class="si">{</span><span class="n">data_type</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">test</span>
        <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;gs://gnomad/v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">/sample_qc/</span><span class="si">{</span><span class="n">data_type</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span></div>


<span class="c1">######################################################################</span>
<span class="c1"># Hard-filtering resources</span>
<span class="c1">######################################################################</span>


<div class="viewcode-block" id="get_sample_qc"><a class="viewcode-back" href="../../../../api_reference/v4/resources/sample_qc.html#gnomad_qc.v4.resources.sample_qc.get_sample_qc">[docs]</a><span class="k">def</span> <span class="nf">get_sample_qc</span><span class="p">(</span>
    <span class="n">strat</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">test</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">data_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;exomes&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VersionedTableResource</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get sample QC annotations generated by Hail for the specified stratification.</span>

<span class="sd">    Possible values for `strat`:</span>
<span class="sd">        - bi_allelic</span>
<span class="sd">        - multi_allelic</span>
<span class="sd">        - all</span>

<span class="sd">    :param strat: Which stratification to return.</span>
<span class="sd">    :param test: Whether to use a tmp path for analysis of the test VDS instead of the</span>
<span class="sd">        full v4 VDS.</span>
<span class="sd">    :param data_type: Data type used in sample QC, e.g. &quot;exomes&quot; or &quot;joint&quot;.</span>
<span class="sd">    :return: Sample QC table.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">VersionedTableResource</span><span class="p">(</span>
        <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
        <span class="p">{</span>
            <span class="n">version</span><span class="p">:</span> <span class="n">TableResource</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_sample_qc_root</span><span class="p">(</span><span class="n">version</span><span class="p">,</span><span class="w"> </span><span class="n">test</span><span class="p">,</span><span class="w"> </span><span class="n">data_type</span><span class="p">)</span><span class="si">}</span><span class="s2">/hard_filtering/gnomad.</span><span class="si">{</span><span class="n">data_type</span><span class="si">}</span><span class="s2">.v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.sample_qc_all</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">strat</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="sa">f</span><span class="s1">&#39;_</span><span class="si">{</span><span class="n">strat</span><span class="si">}</span><span class="s1">&#39;</span><span class="si">}</span><span class="s2">.ht&quot;</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">SAMPLE_QC_VERSIONS</span>
        <span class="p">},</span>
    <span class="p">)</span></div>


<span class="c1"># v4 samples that failed fingerprinting.</span>
<span class="n">fingerprinting_failed</span> <span class="o">=</span> <span class="n">VersionedTableResource</span><span class="p">(</span>
    <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
    <span class="p">{</span>
        <span class="n">version</span><span class="p">:</span> <span class="n">TableResource</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_sample_qc_root</span><span class="p">(</span><span class="n">version</span><span class="p">)</span><span class="si">}</span><span class="s2">/hard_filtering/gnomad.exomes.v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.fingerprintcheck_failures.ht&quot;</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">SAMPLE_QC_VERSIONS</span>
    <span class="p">},</span>
<span class="p">)</span>

<span class="c1"># Mean chr20 DP per sample using Hail&#39;s interval_coverage results.</span>
<span class="n">sample_chr20_mean_dp</span> <span class="o">=</span> <span class="n">VersionedTableResource</span><span class="p">(</span>
    <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
    <span class="p">{</span>
        <span class="n">version</span><span class="p">:</span> <span class="n">TableResource</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_sample_qc_root</span><span class="p">(</span><span class="n">version</span><span class="p">)</span><span class="si">}</span><span class="s2">/hard_filtering/gnomad.exomes.v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.sample_chr20_mean_dp.ht&quot;</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">SAMPLE_QC_VERSIONS</span>
    <span class="p">},</span>
<span class="p">)</span>

<span class="c1"># Sample callrate on variants in the v4 precomputed QC MT.</span>
<span class="n">sample_qc_mt_callrate</span> <span class="o">=</span> <span class="n">VersionedTableResource</span><span class="p">(</span>
    <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
    <span class="p">{</span>
        <span class="n">version</span><span class="p">:</span> <span class="n">TableResource</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_sample_qc_root</span><span class="p">(</span><span class="n">version</span><span class="p">)</span><span class="si">}</span><span class="s2">/hard_filtering/gnomad.exomes.v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.sample_qc_mt_callrate.ht&quot;</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">SAMPLE_QC_VERSIONS</span>
    <span class="p">},</span>
<span class="p">)</span>

<span class="c1"># Sample contamination estimate Table.</span>
<span class="n">contamination</span> <span class="o">=</span> <span class="n">VersionedTableResource</span><span class="p">(</span>
    <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
    <span class="p">{</span>
        <span class="n">version</span><span class="p">:</span> <span class="n">TableResource</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_sample_qc_root</span><span class="p">(</span><span class="n">version</span><span class="p">)</span><span class="si">}</span><span class="s2">/hard_filtering/gnomad.exomes.v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.contamination.ht&quot;</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">SAMPLE_QC_VERSIONS</span>
    <span class="p">},</span>
<span class="p">)</span>

<span class="n">hard_filtered_samples_no_sex</span> <span class="o">=</span> <span class="n">VersionedTableResource</span><span class="p">(</span>
    <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
    <span class="p">{</span>
        <span class="n">version</span><span class="p">:</span> <span class="n">TableResource</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_sample_qc_root</span><span class="p">(</span><span class="n">version</span><span class="p">)</span><span class="si">}</span><span class="s2">/hard_filtering/gnomad.exomes.v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.hard_filtered_samples_no_sex.ht&quot;</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">SAMPLE_QC_VERSIONS</span>
    <span class="p">},</span>
<span class="p">)</span>

<span class="n">hard_filtered_samples</span> <span class="o">=</span> <span class="n">VersionedTableResource</span><span class="p">(</span>
    <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
    <span class="p">{</span>
        <span class="n">version</span><span class="p">:</span> <span class="n">TableResource</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_sample_qc_root</span><span class="p">(</span><span class="n">version</span><span class="p">)</span><span class="si">}</span><span class="s2">/hard_filtering/gnomad.exomes.v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.hard_filtered_samples.ht&quot;</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">SAMPLE_QC_VERSIONS</span>
    <span class="p">},</span>
<span class="p">)</span>

<span class="c1">######################################################################</span>
<span class="c1"># Platform inference resources</span>
<span class="c1">######################################################################</span>

<span class="c1"># VDS Hail interval_coverage results.</span>
<span class="n">interval_coverage</span> <span class="o">=</span> <span class="n">VersionedMatrixTableResource</span><span class="p">(</span>
    <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
    <span class="p">{</span>
        <span class="n">version</span><span class="p">:</span> <span class="n">MatrixTableResource</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_sample_qc_root</span><span class="p">(</span><span class="n">version</span><span class="p">)</span><span class="si">}</span><span class="s2">/platform_inference/gnomad.exomes.v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.interval_coverage.mt&quot;</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">SAMPLE_QC_VERSIONS</span>
    <span class="p">},</span>
<span class="p">)</span>


<span class="k">def</span> <span class="nf">_get_platform_pca_ht_path</span><span class="p">(</span>
    <span class="n">part</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">CURRENT_SAMPLE_QC_VERSION</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get path to files related to platform PCA.</span>

<span class="sd">    :param part: String indicating the type of PCA file to return (loadings,</span>
<span class="sd">        eigenvalues, or scores).</span>
<span class="sd">    :param version: Version of sample QC path to return.</span>
<span class="sd">    :return: Path to requested platform PCA file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_sample_qc_root</span><span class="p">(</span><span class="n">version</span><span class="p">)</span><span class="si">}</span><span class="s2">/platform_inference/gnomad.exomes.v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.platform_pca_</span><span class="si">{</span><span class="n">part</span><span class="si">}</span><span class="s2">.ht&quot;</span>


<span class="n">platform_pca_loadings</span> <span class="o">=</span> <span class="n">VersionedTableResource</span><span class="p">(</span>
    <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
    <span class="p">{</span>
        <span class="n">version</span><span class="p">:</span> <span class="n">TableResource</span><span class="p">(</span>
            <span class="n">_get_platform_pca_ht_path</span><span class="p">(</span>
                <span class="s2">&quot;loadings&quot;</span><span class="p">,</span>
                <span class="n">version</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">SAMPLE_QC_VERSIONS</span>
    <span class="p">},</span>
<span class="p">)</span>

<span class="n">platform_pca_scores</span> <span class="o">=</span> <span class="n">VersionedTableResource</span><span class="p">(</span>
    <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
    <span class="p">{</span>
        <span class="n">version</span><span class="p">:</span> <span class="n">TableResource</span><span class="p">(</span>
            <span class="n">_get_platform_pca_ht_path</span><span class="p">(</span>
                <span class="s2">&quot;scores&quot;</span><span class="p">,</span>
                <span class="n">version</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">SAMPLE_QC_VERSIONS</span>
    <span class="p">},</span>
<span class="p">)</span>

<span class="n">platform_pca_eigenvalues</span> <span class="o">=</span> <span class="n">VersionedTableResource</span><span class="p">(</span>
    <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
    <span class="p">{</span>
        <span class="n">version</span><span class="p">:</span> <span class="n">TableResource</span><span class="p">(</span>
            <span class="n">_get_platform_pca_ht_path</span><span class="p">(</span>
                <span class="s2">&quot;eigenvalues&quot;</span><span class="p">,</span>
                <span class="n">version</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">SAMPLE_QC_VERSIONS</span>
    <span class="p">},</span>
<span class="p">)</span>

<span class="c1"># Inferred sample platforms.</span>
<span class="n">platform</span> <span class="o">=</span> <span class="n">VersionedTableResource</span><span class="p">(</span>
    <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
    <span class="p">{</span>
        <span class="n">version</span><span class="p">:</span> <span class="n">TableResource</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_sample_qc_root</span><span class="p">(</span><span class="n">version</span><span class="p">)</span><span class="si">}</span><span class="s2">/platform_inference/gnomad.exomes.v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.platform.ht&quot;</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">SAMPLE_QC_VERSIONS</span>
    <span class="p">},</span>
<span class="p">)</span>

<span class="c1">######################################################################</span>
<span class="c1"># Sex inference resources</span>
<span class="c1">######################################################################</span>

<span class="c1"># HT with bi-allelic SNPs on chromosome X used in sex imputation f-stat calculation.</span>
<span class="n">f_stat_sites</span> <span class="o">=</span> <span class="n">VersionedTableResource</span><span class="p">(</span>
    <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
    <span class="p">{</span>
        <span class="n">version</span><span class="p">:</span> <span class="n">TableResource</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_sample_qc_root</span><span class="p">(</span><span class="n">version</span><span class="p">)</span><span class="si">}</span><span class="s2">/sex_inference/gnomad.exomes.v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.f_stat_sites.ht&quot;</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">SAMPLE_QC_VERSIONS</span>
    <span class="p">},</span>
<span class="p">)</span>

<span class="c1"># Sex chromosome coverage aggregate stats MT.</span>
<span class="n">sex_chr_coverage</span> <span class="o">=</span> <span class="n">VersionedMatrixTableResource</span><span class="p">(</span>
    <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
    <span class="p">{</span>
        <span class="n">version</span><span class="p">:</span> <span class="n">MatrixTableResource</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_sample_qc_root</span><span class="p">(</span><span class="n">version</span><span class="p">)</span><span class="si">}</span><span class="s2">/sex_inference/gnomad.exomes.v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.sex_chr_coverage.mt&quot;</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">SAMPLE_QC_VERSIONS</span>
    <span class="p">},</span>
<span class="p">)</span>

<span class="c1"># Table containing aggregate stats for interval QC specific to sex imputation.</span>
<span class="n">sex_imputation_interval_qc</span> <span class="o">=</span> <span class="n">VersionedTableResource</span><span class="p">(</span>
    <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
    <span class="p">{</span>
        <span class="n">version</span><span class="p">:</span> <span class="n">TableResource</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_sample_qc_root</span><span class="p">(</span><span class="n">version</span><span class="p">)</span><span class="si">}</span><span class="s2">/sex_inference/gnomad.exomes.v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.sex_imputation_interval_qc.ht&quot;</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">SAMPLE_QC_VERSIONS</span>
    <span class="p">},</span>
<span class="p">)</span>

<span class="c1"># Ploidy imputation results.</span>
<span class="n">ploidy</span> <span class="o">=</span> <span class="n">VersionedTableResource</span><span class="p">(</span>
    <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
    <span class="p">{</span>
        <span class="n">version</span><span class="p">:</span> <span class="n">TableResource</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_sample_qc_root</span><span class="p">(</span><span class="n">version</span><span class="p">)</span><span class="si">}</span><span class="s2">/sex_inference/gnomad.exomes.v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.ploidy.ht&quot;</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">SAMPLE_QC_VERSIONS</span>
    <span class="p">},</span>
<span class="p">)</span>


<span class="c1"># Sex imputation results.</span>
<div class="viewcode-block" id="get_ploidy_cutoff_json_path"><a class="viewcode-back" href="../../../../api_reference/v4/resources/sample_qc.html#gnomad_qc.v4.resources.sample_qc.get_ploidy_cutoff_json_path">[docs]</a><span class="k">def</span> <span class="nf">get_ploidy_cutoff_json_path</span><span class="p">(</span>
    <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span> <span class="n">test</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the sex karyotype ploidy cutoff JSON path for the indicated gnomAD version.</span>

<span class="sd">    :param version: Version of the JSON to return.</span>
<span class="sd">    :param test: Whether to use a tmp path for a test JSON.</span>
<span class="sd">    :return: Path of sex karyotype ploidy cutoff JSON.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">test</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">qc_temp_prefix</span><span class="p">(</span><span class="n">version</span><span class="p">)</span><span class="si">}</span><span class="s2">ploidy_cutoffs.test.json&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_sample_qc_root</span><span class="p">(</span><span class="n">version</span><span class="p">)</span><span class="si">}</span><span class="s2">/sex_inference/gnomad.exomes.v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.ploidy_cutoffs.json&quot;</span></div>


<span class="n">sex</span> <span class="o">=</span> <span class="n">VersionedTableResource</span><span class="p">(</span>
    <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
    <span class="p">{</span>
        <span class="n">version</span><span class="p">:</span> <span class="n">TableResource</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_sample_qc_root</span><span class="p">(</span><span class="n">version</span><span class="p">)</span><span class="si">}</span><span class="s2">/sex_inference/gnomad.exomes.v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.sex.ht&quot;</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">SAMPLE_QC_VERSIONS</span>
    <span class="p">},</span>
<span class="p">)</span>

<span class="c1">######################################################################</span>
<span class="c1"># Interval QC resources</span>
<span class="c1">######################################################################</span>

<span class="c1"># Table containing aggregate stats for interval QC.</span>
<span class="n">interval_qc</span> <span class="o">=</span> <span class="n">VersionedTableResource</span><span class="p">(</span>
    <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
    <span class="p">{</span>
        <span class="n">version</span><span class="p">:</span> <span class="n">TableResource</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_sample_qc_root</span><span class="p">(</span><span class="n">version</span><span class="p">)</span><span class="si">}</span><span class="s2">/interval_qc/gnomad.exomes.v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.interval_qc.ht&quot;</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">SAMPLE_QC_VERSIONS</span>
    <span class="p">},</span>
<span class="p">)</span>


<div class="viewcode-block" id="interval_qc_pass"><a class="viewcode-back" href="../../../../api_reference/v4/resources/sample_qc.html#gnomad_qc.v4.resources.sample_qc.interval_qc_pass">[docs]</a><span class="k">def</span> <span class="nf">interval_qc_pass</span><span class="p">(</span>
    <span class="n">per_platform</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">all_platforms</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VersionedTableResource</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the VersionedTableResource for Table with interval QC pass annotation.</span>

<span class="sd">    :param per_platform: Whether to use the interval QC pass resource with interval QC</span>
<span class="sd">        pass per platform.</span>
<span class="sd">    :param all_platforms: Whether to use the interval QC pass resource where an</span>
<span class="sd">        interval passes QC only if it passes interval QC per platform across all</span>
<span class="sd">        platforms.</span>
<span class="sd">    :return: VersionedTableResource for Table with interval QC pass annotation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">per_platform</span> <span class="ow">and</span> <span class="n">all_platforms</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Only one of &#39;per_platform&#39; and &#39;all_platforms&#39; can be True!&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">per_platform</span><span class="p">:</span>
        <span class="n">postfix</span> <span class="o">=</span> <span class="s2">&quot;.per_platform&quot;</span>
    <span class="k">elif</span> <span class="n">all_platforms</span><span class="p">:</span>
        <span class="n">postfix</span> <span class="o">=</span> <span class="s2">&quot;.all_platforms&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">postfix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">return</span> <span class="n">VersionedTableResource</span><span class="p">(</span>
        <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
        <span class="p">{</span>
            <span class="n">version</span><span class="p">:</span> <span class="n">TableResource</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_sample_qc_root</span><span class="p">(</span><span class="n">version</span><span class="p">)</span><span class="si">}</span><span class="s2">/interval_qc/gnomad.exomes.v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.interval_qc_pass</span><span class="si">{</span><span class="n">postfix</span><span class="si">}</span><span class="s2">.ht&quot;</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">SAMPLE_QC_VERSIONS</span>
        <span class="p">},</span>
    <span class="p">)</span></div>


<span class="c1">######################################################################</span>
<span class="c1"># Generate QC MT resources</span>
<span class="c1">######################################################################</span>


<div class="viewcode-block" id="get_predetermined_qc"><a class="viewcode-back" href="../../../../api_reference/v4/resources/sample_qc.html#gnomad_qc.v4.resources.sample_qc.get_predetermined_qc">[docs]</a><span class="k">def</span> <span class="nf">get_predetermined_qc</span><span class="p">(</span>
    <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span> <span class="n">test</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MatrixTableResource</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the dense MatrixTableResource of all predetermined QC sites for the indicated gnomAD version.</span>

<span class="sd">    :param version: Version of QC MatrixTableResource to return.</span>
<span class="sd">    :param test: Whether to use a tmp path for a test MatrixTableResource.</span>
<span class="sd">    :return: MatrixTableResource of predetermined QC sites.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">test</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">MatrixTableResource</span><span class="p">(</span>
            <span class="n">get_checkpoint_path</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;dense_pre_ld_prune_qc_sites.v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.test&quot;</span><span class="p">,</span> <span class="n">mt</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">version</span> <span class="o">==</span> <span class="s2">&quot;3.1&quot;</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;The gnomAD v3.1 predetermined QC sites were deleted from the gnomAD bucket &quot;</span>
            <span class="s2">&quot;to save space. If you need them, they can be re-generated with the &quot;</span>
            <span class="s2">&quot;v4.sample_qc.generate_qc_mt.py script.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">v3_predetermined_qc</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">v4_predetermined_qc</span><span class="o">.</span><span class="n">versions</span><span class="p">[</span><span class="n">version</span><span class="p">]</span></div>


<span class="c1"># HT of pre LD pruned variants chosen from CCDG, gnomAD v3, and UKB variant info.</span>
<span class="c1"># See: https://github.com/Nealelab/ccdg_qc/blob/master/scripts/pca_variant_filter.py</span>
<span class="n">predetermined_qc_sites</span> <span class="o">=</span> <span class="n">TableResource</span><span class="p">(</span>
    <span class="s2">&quot;gs://gnomad/v4.0/sample_qc/additional_resources/pre_ld_pruning_qc_variants.ht&quot;</span>
<span class="p">)</span>

<span class="c1"># This MT was deleted from the gnomAD bucket to save space. If it is needed, it can be</span>
<span class="c1"># re-generated with the v4.sample_qc.generate_qc_mt.py script.</span>
<span class="c1"># gnomAD v3 dense MT of all predetermined possible QC sites `predetermined_qc_sites`.</span>
<span class="n">v3_predetermined_qc</span> <span class="o">=</span> <span class="n">MatrixTableResource</span><span class="p">(</span>
    <span class="s2">&quot;gs://gnomad/sample_qc/mt/genomes_v3.1/gnomad.genomes.v3.1.pre_ld_prune_qc_sites.dense.mt&quot;</span>
<span class="p">)</span>

<span class="c1"># gnomAD v4 dense MT of all predetermined possible QC sites `predetermined_qc_sites`.</span>
<span class="n">v4_predetermined_qc</span> <span class="o">=</span> <span class="n">VersionedMatrixTableResource</span><span class="p">(</span>
    <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
    <span class="p">{</span>
        <span class="n">version</span><span class="p">:</span> <span class="n">MatrixTableResource</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_sample_qc_root</span><span class="p">(</span><span class="n">version</span><span class="p">)</span><span class="si">}</span><span class="s2">/qc_mt/gnomad.exomes.v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.pre_ld_prune_qc_sites.dense.mt&quot;</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">SAMPLE_QC_VERSIONS</span>
    <span class="p">},</span>
<span class="p">)</span>


<div class="viewcode-block" id="get_joint_qc"><a class="viewcode-back" href="../../../../api_reference/v4/resources/sample_qc.html#gnomad_qc.v4.resources.sample_qc.get_joint_qc">[docs]</a><span class="k">def</span> <span class="nf">get_joint_qc</span><span class="p">(</span><span class="n">test</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VersionedMatrixTableResource</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the dense MatrixTableResource at final joint v3 and v4 QC sites.</span>

<span class="sd">    :param test: Whether to use a tmp path for a test resource.</span>
<span class="sd">    :return: MatrixTableResource of QC sites.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">VersionedMatrixTableResource</span><span class="p">(</span>
        <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
        <span class="p">{</span>
            <span class="n">version</span><span class="p">:</span> <span class="n">MatrixTableResource</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_sample_qc_root</span><span class="p">(</span><span class="n">version</span><span class="p">,</span><span class="w"> </span><span class="n">test</span><span class="p">,</span><span class="w"> </span><span class="n">data_type</span><span class="o">=</span><span class="s1">&#39;joint&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">/qc_mt/gnomad.joint.v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.qc.mt&quot;</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">SAMPLE_QC_VERSIONS</span>
        <span class="p">},</span>
    <span class="p">)</span></div>


<span class="c1"># v3 and v4 combined sample metadata Table for relatedness and population inference.</span>
<span class="n">joint_qc_meta</span> <span class="o">=</span> <span class="n">VersionedTableResource</span><span class="p">(</span>
    <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
    <span class="p">{</span>
        <span class="n">version</span><span class="p">:</span> <span class="n">TableResource</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_sample_qc_root</span><span class="p">(</span><span class="n">version</span><span class="p">,</span><span class="w"> </span><span class="n">data_type</span><span class="o">=</span><span class="s1">&#39;joint&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">/qc_mt/gnomad.joint.v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.qc_meta.ht&quot;</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">SAMPLE_QC_VERSIONS</span>
    <span class="p">},</span>
<span class="p">)</span>


<span class="c1">######################################################################</span>
<span class="c1"># Relatedness resources</span>
<span class="c1">######################################################################</span>


<div class="viewcode-block" id="get_cuking_input_path"><a class="viewcode-back" href="../../../../api_reference/v4/resources/sample_qc.html#gnomad_qc.v4.resources.sample_qc.get_cuking_input_path">[docs]</a><span class="k">def</span> <span class="nf">get_cuking_input_path</span><span class="p">(</span>
    <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span> <span class="n">test</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the path containing the input files read by cuKING.</span>

<span class="sd">    Those files correspond to Parquet tables derived from the dense QC matrix.</span>

<span class="sd">    :param version: gnomAD version.</span>
<span class="sd">    :param test: Whether to return a path corresponding to a test subset.</span>
<span class="sd">    :return: Temporary path to hold Parquet input tables for running cuKING.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># cuKING inputs can be easily regenerated, so use a temp location.</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">qc_temp_prefix</span><span class="p">(</span><span class="n">version</span><span class="p">)</span><span class="si">}</span><span class="s2">cuking_input</span><span class="si">{</span><span class="s1">&#39;_test&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">.parquet&quot;</span></div>


<div class="viewcode-block" id="get_cuking_output_path"><a class="viewcode-back" href="../../../../api_reference/v4/resources/sample_qc.html#gnomad_qc.v4.resources.sample_qc.get_cuking_output_path">[docs]</a><span class="k">def</span> <span class="nf">get_cuking_output_path</span><span class="p">(</span>
    <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span> <span class="n">test</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the path containing the output files written by cuKING.</span>

<span class="sd">    Those files correspond to Parquet tables containing relatedness results.</span>

<span class="sd">    :param version: gnomAD version.</span>
<span class="sd">    :param test: Whether to return a path corresponding to a test subset.</span>
<span class="sd">    :return: Temporary path to hold Parquet output tables for running cuKING.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># cuKING outputs can be easily regenerated, so use a temp location.</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">qc_temp_prefix</span><span class="p">(</span><span class="n">version</span><span class="p">)</span><span class="si">}</span><span class="s2">cuking_output</span><span class="si">{</span><span class="s1">&#39;_test&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">.parquet&quot;</span></div>


<div class="viewcode-block" id="pc_relate_pca_scores"><a class="viewcode-back" href="../../../../api_reference/v4/resources/sample_qc.html#gnomad_qc.v4.resources.sample_qc.pc_relate_pca_scores">[docs]</a><span class="k">def</span> <span class="nf">pc_relate_pca_scores</span><span class="p">(</span><span class="n">test</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VersionedTableResource</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get VersionedTableResource for PCA scores for use in PC-Relate.</span>

<span class="sd">    :param test: Whether to use a tmp path for a test resource.</span>
<span class="sd">    :return: VersionedTableResource.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">VersionedTableResource</span><span class="p">(</span>
        <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
        <span class="p">{</span>
            <span class="n">version</span><span class="p">:</span> <span class="n">TableResource</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_sample_qc_root</span><span class="p">(</span><span class="n">version</span><span class="p">,</span><span class="w"> </span><span class="n">test</span><span class="p">,</span><span class="w"> </span><span class="n">data_type</span><span class="o">=</span><span class="s1">&#39;joint&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">/relatedness/gnomad.joint.v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.pc_scores.ht&quot;</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">SAMPLE_QC_VERSIONS</span>
        <span class="p">},</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="relatedness"><a class="viewcode-back" href="../../../../api_reference/v4/resources/sample_qc.html#gnomad_qc.v4.resources.sample_qc.relatedness">[docs]</a><span class="k">def</span> <span class="nf">relatedness</span><span class="p">(</span>
    <span class="n">method</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">test</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VersionedTableResource</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the VersionedTableResource for relatedness results.</span>

<span class="sd">    :param method: Optional method of relatedness inference to return</span>
<span class="sd">        VersionedTableResource for. One of &#39;cuking&#39; or &#39;pc_relate&#39; if set. Default is</span>
<span class="sd">        None, which will return the finalized relatedness Table.</span>
<span class="sd">    :param test: Whether to use a tmp path for a test resource.</span>
<span class="sd">    :return: VersionedTableResource.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">method</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;cuking&quot;</span><span class="p">,</span> <span class="s2">&quot;pc_relate&quot;</span><span class="p">}:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;method must be one of &#39;cuking&#39; or &#39;pc_relate&#39;!&quot;</span><span class="p">)</span>
        <span class="n">method</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">return</span> <span class="n">VersionedTableResource</span><span class="p">(</span>
        <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
        <span class="p">{</span>
            <span class="n">version</span><span class="p">:</span> <span class="n">TableResource</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_sample_qc_root</span><span class="p">(</span><span class="n">version</span><span class="p">,</span><span class="w"> </span><span class="n">test</span><span class="p">,</span><span class="w"> </span><span class="n">data_type</span><span class="o">=</span><span class="s1">&#39;joint&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">/relatedness/gnomad.joint.v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.relatedness</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">.ht&quot;</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">SAMPLE_QC_VERSIONS</span>
        <span class="p">},</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="ibd"><a class="viewcode-back" href="../../../../api_reference/v4/resources/sample_qc.html#gnomad_qc.v4.resources.sample_qc.ibd">[docs]</a><span class="k">def</span> <span class="nf">ibd</span><span class="p">(</span><span class="n">test</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VersionedTableResource</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get VersionedTableResource for identity-by-descent (ibd) on cuKING related pairs.</span>

<span class="sd">    :param test: Whether to use a tmp path for a test resource.</span>
<span class="sd">    :return: VersionedTableResource.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">VersionedTableResource</span><span class="p">(</span>
        <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
        <span class="p">{</span>
            <span class="n">version</span><span class="p">:</span> <span class="n">TableResource</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_sample_qc_root</span><span class="p">(</span><span class="n">version</span><span class="p">,</span><span class="w"> </span><span class="n">test</span><span class="p">,</span><span class="w"> </span><span class="n">data_type</span><span class="o">=</span><span class="s1">&#39;joint&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">/relatedness/gnomad.joint.v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.ibd.ht&quot;</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">SAMPLE_QC_VERSIONS</span>
        <span class="p">},</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="related_samples_to_drop"><a class="viewcode-back" href="../../../../api_reference/v4/resources/sample_qc.html#gnomad_qc.v4.resources.sample_qc.related_samples_to_drop">[docs]</a><span class="k">def</span> <span class="nf">related_samples_to_drop</span><span class="p">(</span>
    <span class="n">test</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">release</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VersionedTableResource</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the VersionedTableResource for samples to drop for release or ancestry PCA.</span>

<span class="sd">    Default to returning the VersionedTableResource for samples to drop for release.</span>
<span class="sd">    If release is set to False, retrieve the VersionedTableResource of related samples</span>
<span class="sd">    to remove for ancestry PCA.</span>

<span class="sd">    :param test: Whether to use a tmp path for a test resource.</span>
<span class="sd">    :param release: Whether to return resource for related samples to drop for the</span>
<span class="sd">        release based on outlier filtering of sample QC metrics.</span>
<span class="sd">    :return: VersionedTableResource.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">VersionedTableResource</span><span class="p">(</span>
        <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
        <span class="p">{</span>
            <span class="n">version</span><span class="p">:</span> <span class="n">TableResource</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_sample_qc_root</span><span class="p">(</span><span class="n">version</span><span class="p">,</span><span class="w"> </span><span class="n">test</span><span class="p">,</span><span class="w"> </span><span class="n">data_type</span><span class="o">=</span><span class="s1">&#39;joint&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">/relatedness/gnomad.joint.v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.related_samples_to_drop.</span><span class="si">{</span><span class="s1">&#39;release&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">release</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;pca&#39;</span><span class="si">}</span><span class="s2">.ht&quot;</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">SAMPLE_QC_VERSIONS</span>
        <span class="p">},</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="sample_rankings"><a class="viewcode-back" href="../../../../api_reference/v4/resources/sample_qc.html#gnomad_qc.v4.resources.sample_qc.sample_rankings">[docs]</a><span class="k">def</span> <span class="nf">sample_rankings</span><span class="p">(</span><span class="n">test</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">release</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VersionedTableResource</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the VersionedTableResource for sample rankings for release or ancestry PCA.</span>

<span class="sd">    Default to returning the VersionedTableResource for release sample rankings. If</span>
<span class="sd">    release is set to False, retrieve the VersionedTableResource of sample rankings for</span>
<span class="sd">    removing relateds for PCA.</span>

<span class="sd">    :param test: Whether to use a tmp path for a test resource.</span>
<span class="sd">    :param release: Whether to return resource for ranking of all samples based on</span>
<span class="sd">        outlier filtering of sample QC metrics. Used to determine related samples to</span>
<span class="sd">        drop for the release.</span>
<span class="sd">    :return: VersionedTableResource.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">VersionedTableResource</span><span class="p">(</span>
        <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
        <span class="p">{</span>
            <span class="n">version</span><span class="p">:</span> <span class="n">TableResource</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_sample_qc_root</span><span class="p">(</span><span class="n">version</span><span class="p">,</span><span class="w"> </span><span class="n">test</span><span class="p">,</span><span class="w"> </span><span class="n">data_type</span><span class="o">=</span><span class="s1">&#39;joint&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">/relatedness/gnomad.joint.v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.samples_ranking.</span><span class="si">{</span><span class="s1">&#39;release&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">release</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;pca&#39;</span><span class="si">}</span><span class="s2">.ht&quot;</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">SAMPLE_QC_VERSIONS</span>
        <span class="p">},</span>
    <span class="p">)</span></div>


<span class="c1">######################################################################</span>
<span class="c1"># Ancestry inference resources</span>
<span class="c1">######################################################################</span>


<span class="k">def</span> <span class="nf">_get_ancestry_pca_ht_path</span><span class="p">(</span>
    <span class="n">part</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
    <span class="n">include_unreleasable_samples</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">test</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">data_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;joint&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get path to files related to ancestry PCA.</span>

<span class="sd">    :param part: String indicating the type of PCA file to return (loadings,</span>
<span class="sd">        eigenvalues, or scores).</span>
<span class="sd">    :param version: Version of sample QC path to return.</span>
<span class="sd">    :param include_unreleasable_samples: Whether the PCA included unreleasable samples.</span>
<span class="sd">    :param data_type: Data type used in sample QC, e.g. &quot;exomes&quot; or &quot;joint&quot;</span>
<span class="sd">    :return: Path to requested ancestry PCA file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_sample_qc_root</span><span class="p">(</span><span class="n">version</span><span class="p">,</span><span class="w"> </span><span class="n">test</span><span class="p">,</span><span class="w"> </span><span class="n">data_type</span><span class="p">)</span><span class="si">}</span><span class="s2">/ancestry_inference/gnomad.</span><span class="si">{</span><span class="n">data_type</span><span class="si">}</span><span class="s2">.v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.pca_</span><span class="si">{</span><span class="n">part</span><span class="si">}{</span><span class="s1">&#39;_with_unreleasable_samples&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">include_unreleasable_samples</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">.ht&quot;</span>


<div class="viewcode-block" id="ancestry_pca_loadings"><a class="viewcode-back" href="../../../../api_reference/v4/resources/sample_qc.html#gnomad_qc.v4.resources.sample_qc.ancestry_pca_loadings">[docs]</a><span class="k">def</span> <span class="nf">ancestry_pca_loadings</span><span class="p">(</span>
    <span class="n">include_unreleasable_samples</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">test</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">data_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;joint&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VersionedTableResource</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the ancestry PCA loadings VersionedTableResource.</span>

<span class="sd">    :param include_unreleasable_samples: Whether to get the PCA loadings from the PCA</span>
<span class="sd">        that used unreleasable samples.</span>
<span class="sd">    :param test: Whether to use a temp path.</span>
<span class="sd">    :param data_type: Data type used in sample QC, e.g. &quot;exomes&quot; or &quot;joint&quot;</span>
<span class="sd">    :return: Ancestry PCA loadings</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">VersionedTableResource</span><span class="p">(</span>
        <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
        <span class="p">{</span>
            <span class="n">version</span><span class="p">:</span> <span class="n">TableResource</span><span class="p">(</span>
                <span class="n">_get_ancestry_pca_ht_path</span><span class="p">(</span>
                    <span class="s2">&quot;loadings&quot;</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">include_unreleasable_samples</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">data_type</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">SAMPLE_QC_VERSIONS</span>
        <span class="p">},</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="ancestry_pca_scores"><a class="viewcode-back" href="../../../../api_reference/v4/resources/sample_qc.html#gnomad_qc.v4.resources.sample_qc.ancestry_pca_scores">[docs]</a><span class="k">def</span> <span class="nf">ancestry_pca_scores</span><span class="p">(</span>
    <span class="n">include_unreleasable_samples</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">test</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">data_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;joint&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VersionedTableResource</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the ancestry PCA scores VersionedTableResource.</span>

<span class="sd">    :param include_unreleasable_samples: Whether to get the PCA scores from the PCA</span>
<span class="sd">        that used unreleasable samples.</span>
<span class="sd">    :param test: Whether to use a temp path.</span>
<span class="sd">    :param data_type: Data type used in sample QC, e.g. &quot;exomes&quot; or &quot;joint&quot;.</span>
<span class="sd">    :return: Ancestry PCA scores.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">VersionedTableResource</span><span class="p">(</span>
        <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
        <span class="p">{</span>
            <span class="n">version</span><span class="p">:</span> <span class="n">TableResource</span><span class="p">(</span>
                <span class="n">_get_ancestry_pca_ht_path</span><span class="p">(</span>
                    <span class="s2">&quot;scores&quot;</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">include_unreleasable_samples</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">data_type</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">SAMPLE_QC_VERSIONS</span>
        <span class="p">},</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="ancestry_pca_eigenvalues"><a class="viewcode-back" href="../../../../api_reference/v4/resources/sample_qc.html#gnomad_qc.v4.resources.sample_qc.ancestry_pca_eigenvalues">[docs]</a><span class="k">def</span> <span class="nf">ancestry_pca_eigenvalues</span><span class="p">(</span>
    <span class="n">include_unreleasable_samples</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">test</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">data_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;joint&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VersionedTableResource</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the ancestry PCA eigenvalues VersionedTableResource.</span>

<span class="sd">    :param include_unreleasable_samples: Whether to get the PCA eigenvalues from the</span>
<span class="sd">        PCA that used unreleasable samples.</span>
<span class="sd">    :param test: Whether to use a temp path.</span>
<span class="sd">    :param data_type: Data type used in sample QC, e.g. &quot;exomes&quot; or &quot;joint&quot;.</span>
<span class="sd">    :return: Ancestry PCA eigenvalues.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">VersionedTableResource</span><span class="p">(</span>
        <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
        <span class="p">{</span>
            <span class="n">version</span><span class="p">:</span> <span class="n">TableResource</span><span class="p">(</span>
                <span class="n">_get_ancestry_pca_ht_path</span><span class="p">(</span>
                    <span class="s2">&quot;eigenvalues&quot;</span><span class="p">,</span>
                    <span class="n">version</span><span class="p">,</span>
                    <span class="n">include_unreleasable_samples</span><span class="p">,</span>
                    <span class="n">test</span><span class="p">,</span>
                    <span class="n">data_type</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">SAMPLE_QC_VERSIONS</span>
        <span class="p">},</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="pop_rf_path"><a class="viewcode-back" href="../../../../api_reference/v4/resources/sample_qc.html#gnomad_qc.v4.resources.sample_qc.pop_rf_path">[docs]</a><span class="k">def</span> <span class="nf">pop_rf_path</span><span class="p">(</span>
    <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
    <span class="n">test</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">data_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;joint&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Path to RF model used for inferring sample populations.</span>

<span class="sd">    :param version: gnomAD Version.</span>
<span class="sd">    :param test: Whether the RF assignment was from a test dataset.</span>
<span class="sd">    :param data_type: Data type used in sample QC, e.g. &quot;exomes&quot; or &quot;joint&quot;.</span>
<span class="sd">    :return: String path to sample pop RF model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_sample_qc_root</span><span class="p">(</span><span class="n">version</span><span class="p">,</span><span class="w"> </span><span class="n">test</span><span class="p">,</span><span class="w"> </span><span class="n">data_type</span><span class="p">)</span><span class="si">}</span><span class="s2">/ancestry_inference/gnomad.</span><span class="si">{</span><span class="n">data_type</span><span class="si">}</span><span class="s2">.v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.pop.RF_fit.pickle&quot;</span></div>


<div class="viewcode-block" id="get_pop_ht"><a class="viewcode-back" href="../../../../api_reference/v4/resources/sample_qc.html#gnomad_qc.v4.resources.sample_qc.get_pop_ht">[docs]</a><span class="k">def</span> <span class="nf">get_pop_ht</span><span class="p">(</span>
    <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
    <span class="n">test</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">data_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;joint&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the TableResource of samples&#39; inferred population for the indicated gnomAD version.</span>

<span class="sd">    :param version: Version of pop TableResource to return.</span>
<span class="sd">    :param test: Whether to use the test version of the pop TableResource.</span>
<span class="sd">    :param data_type: Data type used in sample QC, e.g. &quot;exomes&quot; or &quot;joint&quot;.</span>
<span class="sd">    :return: TableResource of sample pops.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">TableResource</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_sample_qc_root</span><span class="p">(</span><span class="n">version</span><span class="p">,</span><span class="w"> </span><span class="n">test</span><span class="p">,</span><span class="w"> </span><span class="n">data_type</span><span class="p">)</span><span class="si">}</span><span class="s2">/ancestry_inference/gnomad.</span><span class="si">{</span><span class="n">data_type</span><span class="si">}</span><span class="s2">.v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.pop.ht&quot;</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="get_pop_pr_ht"><a class="viewcode-back" href="../../../../api_reference/v4/resources/sample_qc.html#gnomad_qc.v4.resources.sample_qc.get_pop_pr_ht">[docs]</a><span class="k">def</span> <span class="nf">get_pop_pr_ht</span><span class="p">(</span>
    <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
    <span class="n">test</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">data_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;joint&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the TableResource of ancestry inference precision and recall values.</span>

<span class="sd">    :param version: Version of pop PR TableResource to return.</span>
<span class="sd">    :param test: Whether to use the test version of the pop PR TableResource.</span>
<span class="sd">    :param data_type: Data type used in sample QC, e.g. &quot;exomes&quot; or &quot;joint&quot;.</span>
<span class="sd">    :return: TableResource of ancestry inference PR values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">TableResource</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_sample_qc_root</span><span class="p">(</span><span class="n">version</span><span class="p">,</span><span class="w"> </span><span class="n">test</span><span class="p">,</span><span class="w"> </span><span class="n">data_type</span><span class="p">)</span><span class="si">}</span><span class="s2">/ancestry_inference/gnomad.</span><span class="si">{</span><span class="n">data_type</span><span class="si">}</span><span class="s2">.v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.pop_pr.ht&quot;</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="per_pop_min_rf_probs_json_path"><a class="viewcode-back" href="../../../../api_reference/v4/resources/sample_qc.html#gnomad_qc.v4.resources.sample_qc.per_pop_min_rf_probs_json_path">[docs]</a><span class="k">def</span> <span class="nf">per_pop_min_rf_probs_json_path</span><span class="p">(</span><span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get path to JSON file containing per ancestry group minimum RF probabilities.</span>

<span class="sd">    :param version: Version of the JSON to return.</span>
<span class="sd">    :return: Path to per ancestry group minimum RF probabilities JSON.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_sample_qc_root</span><span class="p">(</span><span class="n">version</span><span class="p">,</span><span class="w"> </span><span class="n">data_type</span><span class="o">=</span><span class="s1">&#39;joint&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">/ancestry_inference/gnomad.joint.v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.pop_min_probs.json&quot;</span></div>


<span class="c1"># Path to ONNX RF model used for inferring genetic ancestry.</span>
<span class="n">onnx_rf</span> <span class="o">=</span> <span class="s2">&quot;gs://gcp-public-data--gnomad/release/4.0/pca/gnomad.v4.0.RF_fit.onnx&quot;</span>


<span class="c1">######################################################################</span>
<span class="c1"># Outlier detection resources</span>
<span class="c1">######################################################################</span>
<div class="viewcode-block" id="stratified_filtering"><a class="viewcode-back" href="../../../../api_reference/v4/resources/sample_qc.html#gnomad_qc.v4.resources.sample_qc.stratified_filtering">[docs]</a><span class="k">def</span> <span class="nf">stratified_filtering</span><span class="p">(</span>
    <span class="n">test</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">pop_stratified</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">platform_stratified</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VersionedTableResource</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get VersionedTableResource for stratified platform/population-based metrics filtering.</span>

<span class="sd">    :param test: Whether to use a tmp path for a test resource.</span>
<span class="sd">    :param pop_stratified: Whether to get resource that includes population</span>
<span class="sd">        stratification in stratified outlier filtering.</span>
<span class="sd">    :param platform_stratified: Whether to get resource that includes platform</span>
<span class="sd">        stratification in stratified outlier filtering.</span>
<span class="sd">    :return: VersionedTableResource.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">postfix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pop_stratified</span><span class="p">:</span>
        <span class="n">postfix</span> <span class="o">+=</span> <span class="s2">&quot;.pop_stratified&quot;</span>
    <span class="k">if</span> <span class="n">platform_stratified</span><span class="p">:</span>
        <span class="n">postfix</span> <span class="o">+=</span> <span class="s2">&quot;.platform_stratified&quot;</span>
    <span class="k">return</span> <span class="n">VersionedTableResource</span><span class="p">(</span>
        <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
        <span class="p">{</span>
            <span class="n">version</span><span class="p">:</span> <span class="n">TableResource</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_sample_qc_root</span><span class="p">(</span><span class="n">version</span><span class="p">,</span><span class="w"> </span><span class="n">test</span><span class="p">)</span><span class="si">}</span><span class="s2">/outlier_detection/gnomad.exomes.v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.stratified_filtering</span><span class="si">{</span><span class="n">postfix</span><span class="si">}</span><span class="s2">.ht&quot;</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">SAMPLE_QC_VERSIONS</span>
        <span class="p">},</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="regressed_filtering"><a class="viewcode-back" href="../../../../api_reference/v4/resources/sample_qc.html#gnomad_qc.v4.resources.sample_qc.regressed_filtering">[docs]</a><span class="k">def</span> <span class="nf">regressed_filtering</span><span class="p">(</span>
    <span class="n">test</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">pop_pc_regressed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">platform_pc_regressed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">platform_stratified</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">include_unreleasable_samples</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VersionedTableResource</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get VersionedTableResource for regression platform/population-based metrics filtering.</span>

<span class="sd">    :param test: Whether to use a tmp path for a test resource.</span>
<span class="sd">    :param pop_pc_regressed: Whether to get resource that includes population PCs in</span>
<span class="sd">        regression filtering.</span>
<span class="sd">    :param platform_pc_regressed: Whether to get resource that includes platform PCs in</span>
<span class="sd">        regression filtering.</span>
<span class="sd">    :param platform_stratified: Whether to get resource that includes platform</span>
<span class="sd">        stratification in regression filtering.</span>
<span class="sd">    :param include_unreleasable_samples: Whether the PCA included unreleasable samples.</span>
<span class="sd">    :return: VersionedTableResource.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">postfix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pop_pc_regressed</span><span class="p">:</span>
        <span class="n">postfix</span> <span class="o">+=</span> <span class="s2">&quot;.pop_pc_regressed&quot;</span>
    <span class="k">if</span> <span class="n">platform_pc_regressed</span><span class="p">:</span>
        <span class="n">postfix</span> <span class="o">+=</span> <span class="s2">&quot;.platform_pc_regressed&quot;</span>
    <span class="k">if</span> <span class="n">platform_stratified</span><span class="p">:</span>
        <span class="n">postfix</span> <span class="o">+=</span> <span class="s2">&quot;.platform_stratified&quot;</span>
    <span class="k">if</span> <span class="n">include_unreleasable_samples</span><span class="p">:</span>
        <span class="n">postfix</span> <span class="o">+=</span> <span class="s2">&quot;.include_unreleasable_samples&quot;</span>
    <span class="k">return</span> <span class="n">VersionedTableResource</span><span class="p">(</span>
        <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
        <span class="p">{</span>
            <span class="n">version</span><span class="p">:</span> <span class="n">TableResource</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_sample_qc_root</span><span class="p">(</span><span class="n">version</span><span class="p">,</span><span class="w"> </span><span class="n">test</span><span class="p">)</span><span class="si">}</span><span class="s2">/outlier_detection/gnomad.exomes.v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.regressed_filtering</span><span class="si">{</span><span class="n">postfix</span><span class="si">}</span><span class="s2">.ht&quot;</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">SAMPLE_QC_VERSIONS</span>
        <span class="p">},</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="nearest_neighbors"><a class="viewcode-back" href="../../../../api_reference/v4/resources/sample_qc.html#gnomad_qc.v4.resources.sample_qc.nearest_neighbors">[docs]</a><span class="k">def</span> <span class="nf">nearest_neighbors</span><span class="p">(</span>
    <span class="n">test</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">platform_stratified</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">approximation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">include_unreleasable_samples</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VersionedTableResource</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get VersionedTableResource for population PCA nearest neighbors.</span>

<span class="sd">    :param test: Whether to use a tmp path for a test resource.</span>
<span class="sd">    :param platform_stratified: Whether to get resource that includes platform</span>
<span class="sd">        stratified nearest neighbors.</span>
<span class="sd">    :param approximation: Whether to get resource that is approximate nearest</span>
<span class="sd">        neighbors.</span>
<span class="sd">    :param include_unreleasable_samples: Whether to get resource that included</span>
<span class="sd">        unreleasable samples in nearest neighbors determination.</span>
<span class="sd">    :return: VersionedTableResource.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">postfix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">platform_stratified</span><span class="p">:</span>
        <span class="n">postfix</span> <span class="o">+=</span> <span class="s2">&quot;.platform_stratified&quot;</span>
    <span class="k">if</span> <span class="n">approximation</span><span class="p">:</span>
        <span class="n">postfix</span> <span class="o">+=</span> <span class="s2">&quot;.approximation&quot;</span>
    <span class="k">if</span> <span class="n">include_unreleasable_samples</span><span class="p">:</span>
        <span class="n">postfix</span> <span class="o">+=</span> <span class="s2">&quot;.include_unreleasable_samples&quot;</span>
    <span class="k">return</span> <span class="n">VersionedTableResource</span><span class="p">(</span>
        <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
        <span class="p">{</span>
            <span class="n">version</span><span class="p">:</span> <span class="n">TableResource</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_sample_qc_root</span><span class="p">(</span><span class="n">version</span><span class="p">,</span><span class="w"> </span><span class="n">test</span><span class="p">)</span><span class="si">}</span><span class="s2">/outlier_detection/gnomad.exomes.v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.nearest_neighbors</span><span class="si">{</span><span class="n">postfix</span><span class="si">}</span><span class="s2">.ht&quot;</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">SAMPLE_QC_VERSIONS</span>
        <span class="p">},</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="nearest_neighbors_filtering"><a class="viewcode-back" href="../../../../api_reference/v4/resources/sample_qc.html#gnomad_qc.v4.resources.sample_qc.nearest_neighbors_filtering">[docs]</a><span class="k">def</span> <span class="nf">nearest_neighbors_filtering</span><span class="p">(</span><span class="n">test</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VersionedTableResource</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get VersionedTableResource for nearest neighbors platform/population-based metrics filtering.</span>

<span class="sd">    :param test: Whether to use a tmp path for a test resource.</span>
<span class="sd">    :return: VersionedTableResource.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">VersionedTableResource</span><span class="p">(</span>
        <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
        <span class="p">{</span>
            <span class="n">version</span><span class="p">:</span> <span class="n">TableResource</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_sample_qc_root</span><span class="p">(</span><span class="n">version</span><span class="p">,</span><span class="w"> </span><span class="n">test</span><span class="p">)</span><span class="si">}</span><span class="s2">/outlier_detection/gnomad.exomes.v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.nearest_neighbors_filtering.ht&quot;</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">SAMPLE_QC_VERSIONS</span>
        <span class="p">},</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="finalized_outlier_filtering"><a class="viewcode-back" href="../../../../api_reference/v4/resources/sample_qc.html#gnomad_qc.v4.resources.sample_qc.finalized_outlier_filtering">[docs]</a><span class="k">def</span> <span class="nf">finalized_outlier_filtering</span><span class="p">(</span><span class="n">test</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VersionedTableResource</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get VersionedTableResource for the finalized outlier filtering.</span>

<span class="sd">    :param test: Whether to use a tmp path for a test resource.</span>
<span class="sd">    :return: VersionedTableResource.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">VersionedTableResource</span><span class="p">(</span>
        <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
        <span class="p">{</span>
            <span class="n">version</span><span class="p">:</span> <span class="n">TableResource</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_sample_qc_root</span><span class="p">(</span><span class="n">version</span><span class="p">,</span><span class="w"> </span><span class="n">test</span><span class="p">)</span><span class="si">}</span><span class="s2">/outlier_detection/gnomad.exomes.v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.final_outlier_filtering.ht&quot;</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">SAMPLE_QC_VERSIONS</span>
        <span class="p">},</span>
    <span class="p">)</span></div>


<span class="c1">######################################################################</span>
<span class="c1"># Trio identification resources</span>
<span class="c1">######################################################################</span>
<div class="viewcode-block" id="duplicates"><a class="viewcode-back" href="../../../../api_reference/v4/resources/sample_qc.html#gnomad_qc.v4.resources.sample_qc.duplicates">[docs]</a><span class="k">def</span> <span class="nf">duplicates</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">VersionedTableResource</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the VersionedTableResource for duplicated (or twin) samples.</span>

<span class="sd">    :return: VersionedTableResource of duplicate samples.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data_type</span> <span class="o">=</span> <span class="s2">&quot;exomes&quot;</span>
    <span class="k">return</span> <span class="n">VersionedTableResource</span><span class="p">(</span>
        <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
        <span class="p">{</span>
            <span class="n">version</span><span class="p">:</span> <span class="n">TableResource</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_sample_qc_root</span><span class="p">(</span><span class="n">version</span><span class="p">,</span><span class="w"> </span><span class="n">data_type</span><span class="o">=</span><span class="n">data_type</span><span class="p">)</span><span class="si">}</span><span class="s2">/relatedness/trios/gnomad.</span><span class="si">{</span><span class="n">data_type</span><span class="si">}</span><span class="s2">.v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.duplicates.ht&quot;</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">SAMPLE_QC_VERSIONS</span>
        <span class="p">},</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="pedigree"><a class="viewcode-back" href="../../../../api_reference/v4/resources/sample_qc.html#gnomad_qc.v4.resources.sample_qc.pedigree">[docs]</a><span class="k">def</span> <span class="nf">pedigree</span><span class="p">(</span>
    <span class="n">finalized</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">fake</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">test</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VersionedPedigreeResource</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the VersionedPedigreeResource for the trio pedigree including multiple trios per family.</span>

<span class="sd">    :param finalized: Whether to return the finalized pedigree resource.</span>
<span class="sd">    :param fake: Whether to return the fake pedigree resource.</span>
<span class="sd">    :param test: Whether to use a tmp path for a test resource. This is only an option</span>
<span class="sd">        for the finalized pedigree, which depends on `ped_mendel_errors`.</span>
<span class="sd">    :return: VersionedPedigreeResource of trio pedigree including multiple trios per</span>
<span class="sd">        family.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">finalized</span> <span class="ow">and</span> <span class="n">fake</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Only one of &#39;finalized&#39; or &#39;fake&#39; can be True!&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">test</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">finalized</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;The test Pedigree is only available for the finalized Pedigree because it &quot;</span>
            <span class="s2">&quot;depends on filtering using `ped_mendel_errors` which has a test option!&quot;</span>
        <span class="p">)</span>
    <span class="n">data_type</span> <span class="o">=</span> <span class="s2">&quot;exomes&quot;</span>
    <span class="k">return</span> <span class="n">VersionedPedigreeResource</span><span class="p">(</span>
        <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
        <span class="p">{</span>
            <span class="n">version</span><span class="p">:</span> <span class="n">PedigreeResource</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_sample_qc_root</span><span class="p">(</span><span class="n">version</span><span class="p">,</span><span class="w"> </span><span class="n">test</span><span class="p">,</span><span class="w"> </span><span class="n">data_type</span><span class="o">=</span><span class="n">data_type</span><span class="p">)</span><span class="si">}</span><span class="s2">/relatedness/trios/gnomad.</span><span class="si">{</span><span class="n">data_type</span><span class="si">}</span><span class="s2">.v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.families</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">finalized</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;.raw&#39;</span><span class="si">}{</span><span class="s1">&#39;.fake&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">fake</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">.fam&quot;</span><span class="p">,</span>
                <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">SAMPLE_QC_VERSIONS</span>
        <span class="p">},</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="trios"><a class="viewcode-back" href="../../../../api_reference/v4/resources/sample_qc.html#gnomad_qc.v4.resources.sample_qc.trios">[docs]</a><span class="k">def</span> <span class="nf">trios</span><span class="p">(</span><span class="n">fake</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">test</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VersionedPedigreeResource</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the VersionedPedigreeResource for finalized trio samples.</span>

<span class="sd">    :param fake: Whether to return the fake trio resource.</span>
<span class="sd">    :param test: Whether to use a tmp path for a test resource. This is only an option</span>
<span class="sd">        for the finalized Pedigree, which depends on `ped_mendel_errors`.</span>
<span class="sd">    :return: VersionedPedigreeResource of trio samples.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data_type</span> <span class="o">=</span> <span class="s2">&quot;exomes&quot;</span>
    <span class="k">return</span> <span class="n">VersionedPedigreeResource</span><span class="p">(</span>
        <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
        <span class="p">{</span>
            <span class="n">version</span><span class="p">:</span> <span class="n">PedigreeResource</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_sample_qc_root</span><span class="p">(</span><span class="n">version</span><span class="p">,</span><span class="w"> </span><span class="n">test</span><span class="p">,</span><span class="w"> </span><span class="n">data_type</span><span class="o">=</span><span class="n">data_type</span><span class="p">)</span><span class="si">}</span><span class="s2">/relatedness/trios/gnomad.</span><span class="si">{</span><span class="n">data_type</span><span class="si">}</span><span class="s2">.v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.trios</span><span class="si">{</span><span class="s1">&#39;.fake&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">fake</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">.fam&quot;</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">SAMPLE_QC_VERSIONS</span>
        <span class="p">},</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="ped_mendel_errors"><a class="viewcode-back" href="../../../../api_reference/v4/resources/sample_qc.html#gnomad_qc.v4.resources.sample_qc.ped_mendel_errors">[docs]</a><span class="k">def</span> <span class="nf">ped_mendel_errors</span><span class="p">(</span><span class="n">test</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VersionedTableResource</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the VersionedTableResource for the number of mendel errors per trio.</span>

<span class="sd">    :param test: Whether to use a tmp path for a test resource.</span>
<span class="sd">    :return: VersionedTableResource of number of mendel errors per trio.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data_type</span> <span class="o">=</span> <span class="s2">&quot;exomes&quot;</span>
    <span class="k">return</span> <span class="n">VersionedTableResource</span><span class="p">(</span>
        <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
        <span class="p">{</span>
            <span class="n">version</span><span class="p">:</span> <span class="n">TableResource</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_sample_qc_root</span><span class="p">(</span><span class="n">version</span><span class="p">,</span><span class="w"> </span><span class="n">test</span><span class="p">,</span><span class="w"> </span><span class="n">data_type</span><span class="o">=</span><span class="n">data_type</span><span class="p">)</span><span class="si">}</span><span class="s2">/relatedness/trios/gnomad.</span><span class="si">{</span><span class="n">data_type</span><span class="si">}</span><span class="s2">.v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.mendel_errors.samples.ht&quot;</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">SAMPLE_QC_VERSIONS</span>
        <span class="p">},</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="ped_filter_param_json_path"><a class="viewcode-back" href="../../../../api_reference/v4/resources/sample_qc.html#gnomad_qc.v4.resources.sample_qc.ped_filter_param_json_path">[docs]</a><span class="k">def</span> <span class="nf">ped_filter_param_json_path</span><span class="p">(</span>
    <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span> <span class="n">test</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get path to JSON file containing filters used to create the finalized Pedigree and trios resources.</span>

<span class="sd">    :param version: Version of the JSON to return.</span>
<span class="sd">    :param test: Whether to use a tmp path for a test resource.</span>
<span class="sd">    :return: Path to Pedigree filter JSON.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_sample_qc_root</span><span class="p">(</span><span class="n">version</span><span class="p">)</span><span class="si">}</span><span class="s2">/relatedness/trios/gnomad.exomes.v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.ped_filters.json&quot;</span></div>


<div class="viewcode-block" id="dense_trio_mt"><a class="viewcode-back" href="../../../../api_reference/v4/resources/sample_qc.html#gnomad_qc.v4.resources.sample_qc.dense_trio_mt">[docs]</a><span class="k">def</span> <span class="nf">dense_trio_mt</span><span class="p">(</span>
    <span class="n">releasable</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">split</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">test</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VersionedMatrixTableResource</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the VersionedMatrixTableResource for the dense trio MatrixTable.</span>

<span class="sd">    :param releasable: Whether to get the resource for the releasable trios only.</span>
<span class="sd">    :param split: Whether to get the resource for the split trio MatrixTable.</span>
<span class="sd">    :param test: Whether to use a tmp path for a test resource.</span>
<span class="sd">    :return: VersionedMatrixTableResource of dense trio MatrixTable.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data_type</span> <span class="o">=</span> <span class="s2">&quot;exomes&quot;</span>
    <span class="k">return</span> <span class="n">VersionedMatrixTableResource</span><span class="p">(</span>
        <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
        <span class="p">{</span>
            <span class="n">version</span><span class="p">:</span> <span class="n">MatrixTableResource</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_sample_qc_root</span><span class="p">(</span><span class="n">version</span><span class="p">,</span><span class="w"> </span><span class="n">test</span><span class="p">,</span><span class="w"> </span><span class="n">data_type</span><span class="o">=</span><span class="s1">&#39;exomes&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;/relatedness/trios/gnomad.</span><span class="si">{</span><span class="n">data_type</span><span class="si">}</span><span class="s2">.v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.trios&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;.releasable&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">releasable</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">.dense&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;.split&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">split</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">.mt&quot;</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">SAMPLE_QC_VERSIONS</span>
        <span class="p">},</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="trio_denovo_ht"><a class="viewcode-back" href="../../../../api_reference/v4/resources/sample_qc.html#gnomad_qc.v4.resources.sample_qc.trio_denovo_ht">[docs]</a><span class="k">def</span> <span class="nf">trio_denovo_ht</span><span class="p">(</span>
    <span class="n">test</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VersionedTableResource</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the VersionedTableResource for the trio de novo Table.</span>

<span class="sd">    :param test: Whether to use a tmp path for a test resource.</span>
<span class="sd">    :return: VersionedTableResource of trio de novo Table.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data_type</span> <span class="o">=</span> <span class="s2">&quot;exomes&quot;</span>
    <span class="k">return</span> <span class="n">VersionedTableResource</span><span class="p">(</span>
        <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
        <span class="p">{</span>
            <span class="n">version</span><span class="p">:</span> <span class="n">TableResource</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_sample_qc_root</span><span class="p">(</span><span class="n">version</span><span class="p">,</span><span class="w"> </span><span class="n">test</span><span class="p">,</span><span class="w"> </span><span class="n">data_type</span><span class="o">=</span><span class="s1">&#39;exomes&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;/relatedness/trios/gnomad.</span><span class="si">{</span><span class="n">data_type</span><span class="si">}</span><span class="s2">.v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.trios.&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;releasable.denovo.ht&quot;</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">SAMPLE_QC_VERSIONS</span>
        <span class="p">},</span>
    <span class="p">)</span></div>


<span class="c1">######################################################################</span>
<span class="c1"># Other resources</span>
<span class="c1">######################################################################</span>
<span class="c1"># Number of clinvar variants per sample.</span>
<span class="n">sample_clinvar_count</span> <span class="o">=</span> <span class="n">VersionedTableResource</span><span class="p">(</span>
    <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">,</span>
    <span class="p">{</span>
        <span class="n">version</span><span class="p">:</span> <span class="n">TableResource</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;gs://gnomad/v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">/sample_qc/additional_resources/gnomad.exomes.v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.clinvar.ht&quot;</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">SAMPLE_QC_VERSIONS</span>
    <span class="p">},</span>
<span class="p">)</span>


<div class="viewcode-block" id="get_sample_qc_field_def_json_path"><a class="viewcode-back" href="../../../../api_reference/v4/resources/sample_qc.html#gnomad_qc.v4.resources.sample_qc.get_sample_qc_field_def_json_path">[docs]</a><span class="k">def</span> <span class="nf">get_sample_qc_field_def_json_path</span><span class="p">(</span><span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">CURRENT_SAMPLE_QC_VERSION</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get path to JSON file containing sample QC metadata HT field definitions.</span>

<span class="sd">    :param version: gnomAD version.</span>
<span class="sd">    :return: Path to sample QC field definitions JSON.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_sample_qc_root</span><span class="p">(</span><span class="n">version</span><span class="p">)</span><span class="si">}</span><span class="s2">/additional_resources/gnomad.exomes.v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.sample_qc_field_definitions.json&quot;</span></div>


<span class="c1"># Table with the set of outliers found by Alicia Martin&#39;s group during pop specific PCA</span>
<span class="c1"># analyses as well as one duplicate sample version from 2023:</span>
<span class="c1"># https://github.com/atgu/hgdp_tgp/blob/master/tutorials/nb2.ipynb.</span>
<span class="n">hgdp_tgp_pop_outliers</span> <span class="o">=</span> <span class="n">TableResource</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;gs://gnomad/v4.0/sample_qc/additional_resources/gnomad.genomes.v4.0.hgdp_tgp_pca_outliers.ht&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Followed the Notebook above by adding a step after run PC relate to save</span>
<span class="c1"># the relatedness_ht, then using `hl.maximal_independent_set` to get the list</span>
<span class="c1"># of related samples</span>
<span class="n">hgdp_tgp_related_samples_to_drop</span> <span class="o">=</span> <span class="n">TableResource</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;gs://gnomad/v4.0/sample_qc/additional_resources/gnomad.genomes.v4.0.hgdp_tgp_related_samples.ht&quot;</span>
<span class="p">)</span>

<span class="c1"># Table with HGDP sample contamination estimates from Konrad Karczewski&#39;s</span>
<span class="c1"># group sample QC.</span>
<span class="n">hgdp_recomputed_freemix</span> <span class="o">=</span> <span class="n">TableResource</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;gs://gnomad/v4.0/sample_qc/additional_resources/gnomad.genomes.v4.0.hgdp_tgp_contam_rate_recomputed.ht&quot;</span>
<span class="p">)</span>

<span class="c1"># Table with new population labels and updated geographic locations for HGDP + 1KG/TGP.</span>
<span class="n">hgdp_tgp_populations_updated</span> <span class="o">=</span> <span class="n">TableResource</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;gs://gnomad/v4.0/sample_qc/additional_resources/gnomad.genomes.v4.0.hgdp_tgp_populations_updated.ht&quot;</span>
<span class="p">)</span>

<span class="c1"># Updated meta Table with all the updated information integrated for HGDP + 1KG/TGP.</span>
<span class="n">hgdp_tgp_meta_updated</span> <span class="o">=</span> <span class="n">TableResource</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;gs://gnomad/v4.0/sample_qc/additional_resources/gnomad.genomes.v4.0.hgdp_tgp_sample_meta.ht&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Table with the HGDP + 1KG/TGP samples that are not related within the</span>
<span class="c1"># subset but are related to any v3.1 release sample outside the subset and</span>
<span class="c1"># were not included in the v3.1 release.</span>
<span class="n">hgdp_tgp_related_to_nonsubset</span> <span class="o">=</span> <span class="n">TableResource</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;gs://gnomad/v4.0/sample_qc/additional_resources/gnomad.genomes.v4.0.hgdp_tgp_related_to_nonsubset.ht&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># List of HGDP + 1KG/TGP samples that are duplicated in the v4.0 exome release.</span>
<span class="n">hgdp_tgp_duplicated_to_exomes</span> <span class="o">=</span> <span class="n">TableResource</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;gs://gnomad/v4.0/sample_qc/additional_resources/gnomad.genomes.v4.0.hgdp_tgp_duplicated_in_exomes.ht&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Table with HGDP + 1KG/TGP relatedness information from Alicia Martin&#39;s</span>
<span class="c1"># group sample QC.</span>
<span class="n">hgdp_tgp_relatedness</span> <span class="o">=</span> <span class="n">TableResource</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;gs://gnomad/v4.0/sample_qc/additional_resources/gnomad.genomes.v4.0.hgdp_tgp_relatedness.ht&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>